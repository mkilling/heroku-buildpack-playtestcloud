#!/usr/bin/env bash
set -o errexit

function error() {
  echo " !     $*" >&2
  exit 1
}

function topic() {
  echo "-----> $*"
}

function indent() {
  c='s/^/       /'
  case $(uname) in
    Darwin) sed -l "$c";;
    *)      sed -u "$c";;
  esac
}

BUILD_DIR=$1
CACHE_DIR=$2

echo "Amending profile script for ffmpeg" | indent
cat <<EOF >$BUILD_DIR/.profile.d/001_ffmpeg.sh
export PATH="\$HOME/.apt/opt/ffmpeg/bin:\$PATH"
EOF


topic "Install wav2png"
cd $BUILD_DIR
git clone https://github.com/playtestcloud/wav2png | indent
cd wav2png/build
make all | indent
echo "Amending profile script for wav2png" | indent
cat <<EOF >$BUILD_DIR/.profile.d/002_wav2png.sh
export PATH="\$HOME/wav2png/bin/Linux:\$PATH"
EOF